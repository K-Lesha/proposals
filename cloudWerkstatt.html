<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Мероприятия — Регистрация</title>
  <link href="https://fonts.googleapis.com/css2?family=Nata+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  /* ============ BASE ============ */
  :root{
    --ov-pad:50px;              /* внешняя «рамка» оверлея по умолчанию */
    --radius:12px;
  }

  * { box-sizing: border-box; }
  html, body { height:100%; }
  body { font-family: 'Nata Sans', system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif; margin:0; }

  /* HERO */
  .hero {
    position: relative;
    background: url('https://cdn.iccbelfast.com/Hall-1-Investment-Conference-Hero-Image-ICC-Belfast-1920x1080px.jpg') center/cover no-repeat;
    color: #fff;
    padding: 96px 20px;
  }
  .hero::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.5); }
  .hero-inner { position: relative; max-width: 1200px; margin: 0 auto; text-align: center; }
  .hero .caption {
    font-size: .9rem; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600;
    margin-bottom: 8px; opacity: .9;
  }
  .hero .subtitle { font-size: 2rem; font-weight: 700; max-width: 900px; margin: 0 auto 40px; line-height: 1.3; }

  /* Белая карточка на hero */
  .hero-card {
    background:#fff; color:#000; border-radius: 12px; padding: 24px;
    max-width: 1000px; margin: 0 auto;
    display: grid; grid-template-columns: auto 1fr auto; gap: 24px; align-items: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  }
  .hero-card img { max-height: 60px; width: auto; }
  .hero-card-content { text-align: center; }
  .hero-card-content h2 { font-size: 1.4rem; font-weight: 700; margin: 0 0 8px; }
  .hero-card-content p { font-size: 1rem; line-height: 1.5; margin: 0; }
  .hero-card .btn-red {
    background:#e10000; color:#fff; border:none; padding:12px 20px; font-size:1rem;
    border-radius:8px; cursor:pointer; white-space:nowrap; min-height:44px;
  }
  .hero-card .btn-red:hover { background:#c70000; }

  /* SEARCH BAR */
  .event-search { max-width:1200px; margin:0 auto; padding:32px 20px 24px; }
  .event-search h2 { margin:0; font-size:26px; font-weight:700; color:#222; }
  .search-row { display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; }
  .search-controls { display:flex; align-items:center; gap:12px; flex: 1 1 480px; justify-content:flex-end; }
  .search-row input{
    flex: 1 1 360px; height:44px; padding:0 14px; font-size:16px; line-height:44px;
    border:1px solid #cfd3d7; border-radius:8px; color:#222; outline:none; min-width: 0;
  }
  .search-row input::placeholder{ color:#8a8f94; }
  .search-row button{
    height:44px; padding:0 18px; border:none; border-radius:8px; background:#e10000; color:#fff;
    font-size:16px; font-weight:700; cursor:pointer; flex:0 0 auto;
  }
  .search-row button:hover{ background:#c70000; }

  /* Лейаут: фильтры + грид */
  .events-wrapper {
    max-width: 1200px; margin: 0 auto; padding: 0 20px 40px;
    display: grid; grid-template-columns: 280px 1fr; gap: 24px;
  }
  .filters { border: 1px solid #e6e8eb; border-radius: 12px; overflow: hidden; align-self: start; background:#fff; }
  .filters header { background:#111; color:#fff; padding:12px 16px; font-weight:600; }
  .filters .box { padding:16px; border-top:1px solid #eee; }
  .filters .box h3 { margin:0 0 10px; font-size:16px; display:flex; align-items:center; gap:8px; }
  .filters .muted { color:#666; font-size:14px; }
  .filters .row { display:flex; gap:8px; }
  .filters .full { width:100%; }
  .filters .btn-outline {
    display:block; width:100%; background:#fff; border:1px solid #0a7cff; color:#0a7cff;
    padding:12px; border-radius:10px; cursor:pointer; text-align:center; min-height:44px;
  }

  .events-grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }

  /* Карточки событий */
  .event-card{ border:1px solid #e6e8eb; border-radius:12px; overflow:hidden; background:#fff; display:flex; flex-direction:column; }
  .event-card-header{
    background:#e10000; color:#fff; padding:16px; /* убрали фиксированную высоту */
    display:flex; align-items:center; justify-content:center;
  }
  .event-card-header h3 { margin:0; font-size:18px; font-weight:700; text-align:center; }
  .event-card-body{ padding:16px; display:flex; flex-direction:column; gap:8px; flex:1; }
  .event-date,.event-place,.event-desc{ margin:0; color:#444; }
  .event-btn{
    margin-top:auto; padding:12px 14px; border:1px solid #000; background:#fff; cursor:pointer; border-radius:10px; min-height:44px;
  }

  /* ===== OVERLAY (модал) ===== */
  .overlay{
    position:fixed; inset:0; display:none; align-items:stretch; justify-content:center; z-index:1000;
    background:rgba(0,0,0,.65);
    padding: max(16px, calc(env(safe-area-inset-top)));         /* безопасные зоны */
    padding: var(--ov-pad);
  }
  .overlay.show{ display:flex; animation:overlayFade .2s ease; }
  @keyframes overlayFade{ from{opacity:0} to{opacity:1} }

  .ov-modal{
    background:#fff; color:#111; border-radius:18px; overflow:hidden;
    width:min(1200px, calc(100vw - 2*var(--ov-pad)));
    height:calc(100dvh - 2*var(--ov-pad));                       /* iOS-friendly */
    box-shadow:0 30px 80px rgba(0,0,0,.35);
    display:grid; grid-template-rows:auto auto 1fr;
  }

  .ov-hero{
    position:relative; min-height:220px; color:#fff;
    background:url('https://videodelivery.net/ad2223e095b603c44858996d4a727ea4/thumbnails/thumbnail.jpg?time=17s') center/cover no-repeat;
  }
  .ov-hero::before{content:""; position:absolute; inset:0; background:rgba(0,0,0,.45);}
  .ov-hero .inner{position:relative; padding:24px 20px 28px;}
  .ov-hero h2{margin:0; font-size:36px; font-weight:700; line-height:1.2;}

  .ov-close{
    position:absolute; top:12px; right:12px; z-index:2;
    border:none; background:rgba(255,255,255,.95); width:44px; height:44px; border-radius:12px;
    font-size:22px; cursor:pointer;
  }
  .ov-close:hover{ background:#fff; }

  .ov-tabs{ background:#f6f7f9; border-bottom:1px solid #e6e8eb; position:sticky; top:0; z-index:1; }
  .ov-tabs .row{ display:flex; gap:8px; padding:10px; overflow:auto; -webkit-overflow-scrolling:touch; }
  .ov-tab{
    appearance:none; border:none; background:transparent; padding:10px 14px;
    border-radius:10px; cursor:pointer; font-weight:700; white-space:nowrap; min-height:40px;
  }
  .ov-tab[aria-current="true"], .ov-tab:hover{ background:#fff; box-shadow:inset 0 0 0 1px #e6e8eb; }

  .ov-content{ overflow:auto; padding:20px; }
  .ov-section{ padding:18px 0; border-bottom:1px solid #eee; }
  .ov-section h3{ margin:0 0 10px; font-size:20px; font-weight:700; }
  .ov-section p{ margin:0; color:#444; line-height:1.55; }

  .ov-cta{ display:flex; justify-content:flex-end; padding-top:12px; }
  .ov-cta .btn-red{ background:#e10000; color:#fff; border:none; padding:12px 18px; border-radius:10px; font-weight:700; cursor:pointer; }

  /* Контент + сайдбар */
  .ov-grid{
    display:grid;
    grid-template-columns: minmax(0,1.8fr) minmax(420px,1fr);
    gap:28px;
  }
  .ov-aside{ position:sticky; top:56px; align-self:start; }
  .reg-card{ background:#fff; border:1px solid #e6e8eb; border-radius:12px; padding:16px; box-shadow:0 4px 14px rgba(0,0,0,.06); }
  .reg-card h4{ margin:0 0 8px; font-size:18px; }
  .reg-hint{ color:#666; font-size:14px; margin:0 0 12px; }

  .form .field{ margin-bottom:12px; }
  .form label{ display:block; font-size:14px; margin-bottom:6px; color:#333; font-weight:700; }
  .form input, .form select, .form textarea {
    width:100%; max-width:100%; font-size:16px; border:1px solid #cfd3d7; border-radius:10px; padding:10px 12px; min-height:44px;
  }
  .form .row{ display:flex; gap:12px; }
  .form .row .col{ flex:1; min-width:0; }
  .form .submit{
    width:100%; background:#e10000; color:#fff; border:none; padding:12px 16px;
    border-radius:10px; font-weight:800; cursor:pointer; min-height:48px;
  }
  .form .submit[disabled]{ opacity:.7; cursor:default; }
  .form .msg{ margin-top:10px; font-size:14px; }
  .form .msg.ok{ color:#0a7c3a; }
  .form .msg.err{ color:#d32f2f; }

  /* ============ RESPONSIVE BREAKPOINTS ============ */

  /* <= 1024px: немного крупнее поля, грид карточек компактнее */
  @media (max-width: 1024px){
    .events-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
    .ov-grid { grid-template-columns: 1fr; }       /* сайдбар под контентом */
    .ov-aside{ position:static; }
  }

  /* <= 860px: фильтры над гридом */
  @media (max-width: 860px){
    .events-wrapper { grid-template-columns: 1fr; gap:16px; }
    .filters { order:-1; }
  }

  /* <= 740px: уплотняем hero и overlay, уменьшаем var(--ov-pad) */
  @media (max-width: 740px){
    :root { --ov-pad:20px; }
    .hero { padding:72px 16px; }
    .hero .subtitle { font-size:1.6rem; margin-bottom:24px; }
    .hero-card { grid-template-columns: 1fr; text-align:center; padding:20px; gap:16px; }
    .hero-card img { margin:0 auto; max-height:48px; }

    .ov-hero{ min-height:180px; }
    .ov-hero h2{ font-size:28px; }
    .ov-content{ padding:16px; }
    .ov-tabs .row{ padding:8px; }
  }

  /* <= 600px: поиск — в столбик; поля и кнопки на всю ширину; карточки крупнее */
  @media (max-width: 600px){
    .search-row { align-items: stretch; }
    .search-controls{ width:100%; justify-content:stretch; }
    .search-row input{ width:100%; flex:1 1 auto; }
    .search-row button{ width:100%; }

    .events-grid { grid-template-columns: 1fr; }
    .event-card-header h3 { font-size:17px; }
    .event-card-body { padding:14px; gap:6px; }
    .event-btn{ width:100%; }

    .filters .row { flex-direction:column; }
  }

  /* <= 420px: ещё компактнее типографика и отступы */
  @media (max-width: 420px){
    :root { --ov-pad:16px; }
    .hero { padding:60px 14px; }
    .hero .subtitle { font-size:1.4rem; }
    .event-search { padding:24px 14px 16px; }
    .events-wrapper { padding: 0 14px 28px; }
    .ov-hero .inner{ padding:20px 16px 24px; }
    .ov-tabs .row{ gap:6px; }
    .ov-tab{ padding:8px 12px; min-height:36px; }
  }

  /* Фокус‑видимость для клавиатурной навигации на мобилке */
  :focus-visible{ outline: 2px solid #0a7cff; outline-offset: 2px; border-radius: 8px; }
</style>
</head>
<body>
  <!-- HERO -->
<section class="hero" aria-label="Hero">
  <div class="hero-inner">
    <h1>Red Hat Events</h1>
    <p class="subtitle">Konferenzen, Online-Events, On-Demand-Webinars und mehr</p>

    <div class="hero-card">
      <!-- Левая колонка -->
      <img src="https://www.redhat.com/rhdc/managed-files/Red%20Hat%20Summit%20Connect%20logo_0.png" alt="Red Hat Summit Connect" />
      
      <!-- Центральная колонка -->
      <div class="hero-card-content">
        <h2>Red Hat Summit: Connect 2025</h2>
        <p>Jetzt vormerken! Besuchen Sie den Red Hat Summit: Connect 2025 in einem Ort in Ihrer Nähe. Tauschen Sie sich mit Gleichgesinnten und Experten über die aktuellen Technologien aus, testen Sie die neuesten Tools und Features und bereiten Sie sich auf kommende Herausforderungen vor.</p>
      </div>
      
      <!-- Правая колонка -->
      <button class="btn-red">Mehr erfahren</button>
    </div>
  </div>
</section>

  <!-- SEARCH BAR -->
<section class="event-search" aria-label="Поиск мероприятий">
  <div class="search-row">
    <h2>Event suchen</h2>
    <div class="search-controls">
      <input type="text" id="eventSearch" placeholder="Alle Events durchsuchen" />
      <button id="searchBtn">Suche</button>
    </div>
  </div>
</section>

  <!-- FILTERS + CARDS -->
  <section id="events" class="events-list" aria-label="Список мероприятий">
    <div class="events-wrapper">
      <!-- left: filters -->
      <aside class="filters" aria-label="Фильтры">
        <header>Filtern</header>

        <div class="box">
          <button id="clearFilters" class="btn-outline">Filter löschen</button>
        </div>

        <!-- place -->
        <div class="box">
          <h3>Region</h3>
          <div class="row">
            <input id="placeInput" class="full" type="text" placeholder="z. B. Wien, Online…" />
          </div>
          <p class="muted">Фильтр по строке «place» (любая подстрока).</p>
        </div>

        <!-- time -->
        <div class="box">
          <h3>Zeitpunkt</h3>
          <label><input type="radio" name="when" value="upcoming" checked /> Kommende Events</label><br/>
          <label><input type="radio" name="when" value="past" /> Vergangene Events</label><br/>
          <label><input type="radio" name="when" value="all" /> Alle</label>
        </div>
      </aside>

      <!-- right: cards grid -->
      <div class="events-grid" id="eventsGrid"></div>
    </div>

  </section>


  <script>

    // ---------- Данные ----------
const EVENTS = [
  { id:"evt_001", title:"Intro zu UX Writing",
    dateISO:"2025-09-12T18:00:00+02:00", place:"Wien, Maria-Theresien-Straße 5",
    desc:"Grundlagen-Workshop zu UX-Texten. Übungen zu Formulierungen, Micro-Copywriting."
  },
  { id:"evt_002", title:"SwiftUI MVVM Tag",
    dateISO:"2025-09-20T10:00:00+02:00", place:"Online",
    desc:"MVVM-Architektur in der Praxis. Module, ViewModel, Navigation, State."
  },
  { id:"evt_003", title:"n8n + Supabase Automatisierung",
    dateISO:"2025-10-03T14:00:00+02:00", place:"Wien, Impact Hub",
    desc:"Integrationen und Webhooks ohne Stress. Tipps aus der Praxis."
  },
  { id:"evt_004", title:"HTML und Automatisierung",
    dateISO:"2025-10-03T14:00:00+02:00", place:"Wien, Impact Hub",
    desc:"Integrationen und Webhooks ohne Stress. Tipps aus der Praxis."
  }
];
  window.EVENTS = EVENTS;   // ← добавь эту строку сразу после массива
    // ---------- Рендер карточек ----------
    const eventsGrid = document.getElementById("eventsGrid");

    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleString("de-DE", {
        day: "numeric", month: "long", year: "numeric",
        hour: "2-digit", minute: "2-digit",
        timeZoneName: "short"
      });
    }


    function renderEvents(list) {
  eventsGrid.innerHTML = "";
  if (!list.length) {
    eventsGrid.innerHTML = `<p class="muted">Ничего не найдено.</p>`;
    return;
  }

  list
    .slice()
    .sort((a, b) => new Date(a.dateISO) - new Date(b.dateISO))
    .forEach(evt => {
      const card = document.createElement("article");
      card.className = "event-card";
      card.setAttribute("data-id", evt.id);

      card.innerHTML = `
        <div class="event-card-header">
          <h3>${evt.title}</h3>
        </div>
        <div class="event-card-body">
          <p class="event-date">${formatDate(evt.dateISO)}</p>
          <p class="event-place">${evt.place}</p>
          <p class="event-desc">${evt.desc}</p>
          <button class="event-btn" data-action="details" aria-label="Подробнее о ${evt.title}">Mehr erfahren</button>
        </div>
      `;

      eventsGrid.appendChild(card); // ← ЭТОГО НЕ ХВАТАЛО
    });
}

    // ---------- Фильтрация ----------
    const state = {
      term: "",     // строка поиска
      place: "",    // фильтр по place
      when: "upcoming" // upcoming | past | all
    };

    function applyFilters() {
      const now = new Date();

      const filtered = EVENTS.filter(evt => {
        const inSearch =
          !state.term ||
          evt.title.toLowerCase().includes(state.term) ||
          evt.place.toLowerCase().includes(state.term) ||
          evt.desc.toLowerCase().includes(state.term);

        const inPlace =
          !state.place || evt.place.toLowerCase().includes(state.place);

        const d = new Date(evt.dateISO);
        const inTime =
          state.when === "all" ||
          (state.when === "upcoming" && d >= now) ||
          (state.when === "past" && d < now);

        return inSearch && inPlace && inTime;
      });

      renderEvents(filtered);
    }

    // первоначальный рендер
    renderEvents(EVENTS);

    // ---------- Поиск + фильтры ----------
    const searchInput = document.getElementById("eventSearch");
    const searchBtn = document.getElementById("searchBtn");
    const placeInput = document.getElementById("placeInput");
    const whenRadios = document.querySelectorAll('input[name="when"]');
    const clearBtn = document.getElementById("clearFilters");

    // поиск по кнопке
    searchBtn.addEventListener("click", () => {
      state.term = (searchInput.value || "").toLowerCase();
      applyFilters();
    });

    // live-поиск по вводу (опционально удобно)
    searchInput.addEventListener("input", () => {
      state.term = (searchInput.value || "").toLowerCase();
      applyFilters();
    });

    // фильтр по месту
    placeInput.addEventListener("input", () => {
      state.place = (placeInput.value || "").toLowerCase();
      applyFilters();
    });

    // по времени
    whenRadios.forEach(r => r.addEventListener("change", (e) => {
      state.when = e.target.value;
      applyFilters();
    }));

    // сброс
    clearBtn.addEventListener("click", () => {
      state.term = "";
      state.place = "";
      state.when = "upcoming";
      searchInput.value = "";
      placeInput.value = "";
      document.querySelector('input[name="when"][value="upcoming"]').checked = true;
      applyFilters();
    });

  </script>

<!-- OVERLAY -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="ov-modal" role="document">
    <button class="ov-close" id="ovClose" aria-label="Schließen">×</button>

    <!-- HERO -->
    <section class="ov-hero" id="ovHero">
      <div class="inner">
        <div class="caption" style="opacity:.9; font-weight:600; text-transform:uppercase; letter-spacing:1px; font-size:.85rem;">
          Events
        </div>
        <h2 id="ovTitle">—</h2>
      </div>
    </section>

    <!-- TAB BAR -->
    <nav class="ov-tabs" aria-label="Menü">
      <div class="row" id="ovTabs">
        <button class="ov-tab" data-target="#agenda"           aria-current="true">Agenda</button>
        <button class="ov-tab" data-target="#highlights">Event Highlights</button>
        <button class="ov-tab" data-target="#sponsors">Sponsor:innen</button>
        <button class="ov-tab" data-target="#venue">Veranstaltungsort</button>
        <button class="ov-tab" data-target="#register">Jetzt registrieren</button>
      </div>
    </nav>

    <!-- CONTENT -->
   <main class="ov-content" id="ovScrollArea">
  <div class="ov-grid">
    <!-- LEFT: main content -->
    <div class="ov-main">
      <section class="ov-section" id="agenda">
        <h3>Agenda</h3>
        <p id="ovDate"></p>
        <p>
          09:00 – Registrierung und Begrüßungskaffee<br>
          10:00 – Keynote: The Future of Open Source<br>
          11:30 – Breakout Sessions (Cloud, Automation, Security)<br>
          13:00 – Mittagspause<br>
          14:00 – Workshops & Hands-on Labs<br>
          17:00 – Networking & Abschluss
        </p>
      </section>

      <section class="ov-section" id="highlights">
        <h3>Event Highlights</h3>
        <p id="ovDesc"></p>
        <p>
          • Exklusive Einblicke in neue Red Hat Technologien<br>
          • Live-Demos von Experten<br>
          • Gelegenheit zum Austausch mit Branchenführern<br>
          • Zertifizierte Hands-on Trainings<br>
          • Partner-Ausstellung mit neuesten Lösungen
        </p>
      </section>

      <section class="ov-section" id="sponsors">
        <h3>Sponsor:innen</h3>
        <p>
          Hauptsponsoren: TechCorp, CloudNet, DevOpsPro<br>
          Premium Partner: CodeBase GmbH, DataSecure AG<br>
          Medienpartner: IT Today, OpenSource Weekly
        </p>
      </section>

      <section class="ov-section" id="venue">
        <h3>Veranstaltungsort</h3>
        <p id="ovPlace"></p>
        <p>
          darmstadtium Wissenschafts- und Kongresszentrum<br>
          Schlossgraben 1, 64283 Darmstadt, Deutschland<br>
          Modernes Konferenzzentrum mit hervorragender Anbindung an ÖPNV und Hotels.
        </p>
      </section>

      <section class="ov-section" id="register">
        <h3>Jetzt registrieren</h3>
        <p>
          Sichern Sie sich jetzt Ihren Platz für das Event. Die Teilnahmeplätze sind begrenzt.
          Frühe Anmeldung wird empfohlen.
        </p>

      </section>
    </div>

    <!-- RIGHT: sticky registration form -->
    <aside class="ov-aside" aria-label="Registration form">
      <div class="reg-card">
        <h4>Register for the event</h4>
        <p class="reg-hint">Mit Account einloggen oder ohne Konto anmelden.</p>

        <form id="regForm" class="form" novalidate>
          <div class="row">
            <div class="col">
              <div class="field">
                <label for="firstName">Vorname *</label>
                <input id="firstName" name="firstName" required />
              </div>
            </div>
            <div class="col">
              <div class="field">
                <label for="lastName">Nachname *</label>
                <input id="lastName" name="lastName" required />
              </div>
            </div>
          </div>

          <div class="field">
            <label for="email">Email *</label>
            <input id="email" type="email" name="email" required />
          </div>

          <div class="field">
            <label for="phone">Telefon</label>
            <input id="phone" name="phone" />
          </div>

          <div class="field">
            <label for="company">Firmenname</label>
            <input id="company" name="company" />
          </div>

          <div class="row">
            <div class="col">
              <div class="field">
                <label for="country">Land</label>
                <input id="country" name="country" />
              </div>
            </div>
            <div class="col">
              <div class="field">
                <label for="city">Stadt</label>
                <input id="city" name="city" />
              </div>
            </div>
          </div>

          <div class="field">
            <label><input type="checkbox" id="consent" required /> Ich stimme der Verarbeitung meiner Daten zu.</label>
          </div>

          <button class="submit" type="submit" id="regSubmit">Get started</button>
          <div class="msg" id="regMsg"></div>
        </form>
      </div>
    </aside>
  </div>
</main>


  </div>
</div>

<script>
  // === Overlay wiring v2 ===
const overlayEl = document.getElementById("overlay");
const ovClose   = document.getElementById("ovClose");
const ovTitleEl = document.getElementById("ovTitle");
const ovDateEl  = document.getElementById("ovDate");
const ovPlaceEl = document.getElementById("ovPlace");
const ovDescEl  = document.getElementById("ovDesc");
const ovHero    = document.getElementById("ovHero");
const ovScroll  = document.getElementById("ovScrollArea");

// фон для героя — твоя картинка по умолчанию
const DEFAULT_HERO_BG = "https://videodelivery.net/ad2223e095b603c44858996d4a727ea4/thumbnails/thumbnail.jpg?time=17s";

function fmt(iso){
  const d = new Date(iso);
  return d.toLocaleString("de-DE", { day:"numeric", month:"long", year:"numeric",
    hour:"2-digit", minute:"2-digit", timeZoneName:"short" });
}

function closeOverlay(){
  overlayEl.classList.remove("show");
  overlayEl.setAttribute("aria-hidden","true");
  document.body.style.overflow = "";
}

// закрытие
overlayEl.addEventListener("click", e => { if (e.target === overlayEl) closeOverlay(); });
ovClose.addEventListener("click", closeOverlay);
document.addEventListener("keydown", e => { if (e.key === "Escape") closeOverlay(); });

// клик по карточке — открываем
document.getElementById("eventsGrid").addEventListener("click", (e)=>{
  const btn = e.target.closest('[data-action="details"]');
  if (!btn) return;
  const id = btn.closest(".event-card")?.getAttribute("data-id");
  const evt = (window.EVENTS || []).find(x => x.id === id);
  if (evt) openEventOverlay(evt);
});

// TAB BAR: скроллим к секции
function setActiveTab(tabBtn){
  document.querySelectorAll('.ov-tab').forEach(b=>b.removeAttribute('aria-current'));
  tabBtn?.setAttribute('aria-current','true');
}
document.getElementById("ovTabs").addEventListener("click", (e)=>{
  const btn = e.target.closest(".ov-tab");
  if(!btn) return;
  const sel = btn.getAttribute("data-target");
  const target = sel ? document.querySelector(sel) : null;
  if(target){
    setActiveTab(btn);
    target.scrollIntoView({ behavior:"smooth", block:"start" });
  }
});



// экспорт при желании вызывать из hero
window.openEventOverlay = openEventOverlay;

let currentEvent = null; // активное событие в оверлее

function openEventOverlay(evt){
  currentEvent = evt; // <-- добавили
window.currentEvent = evt;   // <— добавь эту строку
  ovTitleEl.textContent = evt.title || "";
  if (ovDateEl)  ovDateEl.textContent  = evt.dateISO ? fmt(evt.dateISO) : "";
  if (ovPlaceEl) ovPlaceEl.textContent = evt.place || "";
  if (ovDescEl)  ovDescEl.textContent  = evt.desc || "";

  const bg = evt.image || DEFAULT_HERO_BG;
  ovHero.style.backgroundImage = `url("${bg}")`;

  overlayEl.classList.add("show");
  overlayEl.setAttribute("aria-hidden","false");
  document.body.style.overflow = "hidden";
  ovScroll.scrollTop = 0;
  setActiveTab(document.querySelector('.ov-tab[data-target="#agenda"]'));
}

// submit → твой WEBHOOK_URL
const WEBHOOK_URL = "https://betters-technology.site/webhook/a62b454b-ab36-443a-bccd-8d736b4b8a7a";
const regForm   = document.getElementById("regForm");
const regMsg    = document.getElementById("regMsg");
const regSubmit = document.getElementById("regSubmit");

function postWithTimeout(url, options = {}, timeoutMs = 15000) {
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), timeoutMs);
  return fetch(url, { ...options, signal: ctrl.signal }).finally(() => clearTimeout(t));
}

if (regForm) {
  // на всякий случай вешаем и click, и submit
  regSubmit?.addEventListener("click", () => regForm.requestSubmit());

  regForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    regMsg.className = "msg";
    regMsg.textContent = "";

    const data = {
      type: "event_registration",
      eventId:   (window.currentEvent?.id)    ?? null,
      eventTitle:(window.currentEvent?.title) ?? null,
      firstName: regForm.firstName.value.trim(),
      lastName:  regForm.lastName.value.trim(),
      email:     regForm.email.value.trim(),
      phone:     regForm.phone.value.trim(),
      company:   regForm.company.value.trim(),
      country:   regForm.country.value.trim(),
      city:      regForm.city.value.trim(),
      consent:   regForm.consent.checked,
      // полезные метаданные
      pageUrl:   location.href,
      userAgent: navigator.userAgent,
      ts:        new Date().toISOString()
    };

    if (!data.firstName || !data.lastName || !data.email || !data.consent) {
      regMsg.className = "msg err";
      regMsg.textContent = "Bitte füllen Sie alle Pflichtfelder aus.";
      return;
    }

    try {
      regSubmit.disabled = true;
      const origText = regSubmit.textContent;
      regSubmit.textContent = "Sending…";

      const res = await postWithTimeout(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }, 15000);

      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      regMsg.className = "msg ok";
      regMsg.textContent = "Danke! Ihre Anmeldung wurde gesendet.";
      regForm.reset();
    } catch (err) {
      regMsg.className = "msg err";
      regMsg.textContent = "Fehler beim Senden. Bitte versuchen Sie es erneut.";
      console.error(err);
    } finally {
      regSubmit.disabled = false;
      regSubmit.textContent = "Get started";
    }
  });
}
</script>
</body>
</html>
